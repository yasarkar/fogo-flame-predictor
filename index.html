<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fogo Flame Predictor</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body {font-family: Arial;background:#000;color:#fff;text-align:center;margin:0;padding:20px;}
    h1 {color:#ff3300;}
    input, select, button {padding:12px;margin:8px;font-size:18px;border-radius:12px;border:none;}
    button {cursor:pointer;}
    #up {background:#0f0;color:#000;}
    #down {background:#f33;}
    #chart {width:100%;max-width:500px;height:300px;margin:20px auto;background:#111;border-radius:12px;}
    #info {font-size:20px;margin:15px;}
  </style>
</head>
<body>
  <h1>FOGO FLAME PREDICTOR</h1>
  <input id="username" placeholder="Username" />
  <input id="solana" placeholder="Solana Adres" />
  <button onclick="start()">BAŞLA</button>

  <div id="game" style="display:none;">
    <select id="pair">
      <option>SOL-USDT</option>
      <option>BTC-USDT</option>
      <option>ETH-USDT</option>
    </select>
    <div id="chart"></div>
    <button id="up">YUKARI</button>
    <button id="down">AŞAĞI</button>
    <div id="timer">10</div>
    <div id="info">Taş: <span id="gems">0</span> | Kalan Deneme: <span id="attempts">10</span></div>
  </div>

  <script>
    const socket = io('wss://185.182.187.79:3000'); // ADIM 7'de IP'yi yaz
    let chart, series, username, solana, currentPair = 'solana';
    const pairs = {'SOL-USDT':'solana','BTC-USDT':'bitcoin','ETH-USDT':'ethereum'};

    function start() {
      username = document.getElementById('username').value.trim();
      solana = document.getElementById('solana').value.trim();
      if (!username || !solana) return alert("Username ve Solana adresi gir!");
      document.getElementById('game').style.display = 'block';
      socket.emit('join', {username, solana});
    }

    socket.on('init', d => {
      document.getElementById('gems').innerText = d.gems;
      document.getElementById('attempts').innerText = d.attempts;
    });

    socket.on('price', data => {
      if (!chart) {
        chart = LightweightCharts.createChart(document.getElementById('chart'), {width:500,height:300});
        series = chart.addCandlestickSeries();
      }
      series.setData(data.history);
      startTimer();
    });

    function startTimer() {
      let t=10;
      const iv=setInterval(()=>{document.getElementById('timer').innerText=--t; if(t<=0)clearInterval(iv);},1000);
    }

    document.getElementById('pair').onchange = () => {
      currentPair = pairs[document.getElementById('pair').value];
      socket.emit('changePair', currentPair);
    };

    document.getElementById('up').onclick = () => predict('up');
    document.getElementById('down').onclick = () => predict('down');

    function predict(dir) {
      if (document.getElementById('timer').innerText != '0') return;
      socket.emit('predict', {pair: currentPair, dir, username});
    }

    socket.on('result', r => {
      document.getElementById('gems').innerText = r.gems;
      document.getElementById('attempts').innerText = r.attempts;
      alert(r.correct ? "DOĞRU! +1 Taş" : "YANLIŞ!");
    });
  </script>
</body>
</html>
