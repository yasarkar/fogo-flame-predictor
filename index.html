<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fogo Flame Predictor</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { font-family: Arial; background: #000; color: #fff; text-align: center; margin: 0; padding: 20px; }
    #chart { width: 100%; max-width: 500px; height: 300px; margin: 20px auto; background: #111; border-radius: 12px; }
    button { padding: 15px 30px; margin: 10px; font-size: 20px; border: none; border-radius: 12px; cursor: pointer; }
    #up { background: #0f0; } #down { background: #f33; }
    #info { font-size: 18px; margin: 10px; }
    input { padding: 10px; width: 200px; margin: 10px; }
  </style>
</head>
<body>
  <h1>FOGO FLAME PREDICTOR</h1>
  <input id="username" placeholder="Username" />
  <input id="solana" placeholder="Solana Adres" />
  <button onclick="start()">BAŞLA</button>
  <div id="game" style="display:none;">
    <select id="pair">
      <option>SOL-USDT</option>
      <option>BTC-USDT</option>
      <option>ETH-USDT</option>
    </select>
    <div id="chart"></div>
    <button id="up">YUKARI</button>
    <button id="down">AŞAĞI</button>
    <div id="timer">10</div>
    <div id="info">Taş: <span id="gems">0</span> | Kalan: <span id="attempts">10</span></div>
  </div>

  <script>
    const socket = io('wss://fogo-predictor.senincontaboip.com'); // ADIM 5'te IP'yi yaz
    let chart, series, username, solana, currentPair = 'sol';
    const pairs = { 'SOL-USDT': 'solana', 'BTC-USDT': 'bitcoin', 'ETH-USDT': 'ethereum' };

    function start() {
      username = document.getElementById('username').value.trim();
      solana = document.getElementById('solana').value.trim();
      if (!username || !solana) return alert("Username ve Solana adresi gir!");
      document.getElementById('game').style.display = 'block';
      socket.emit('join', { username, solana });
    }

    socket.on('init', data => {
      document.getElementById('gems').innerText = data.gems;
      document.getElementById('attempts').innerText = data.attempts;
    });

    socket.on('price', data => {
      if (!chart) {
        chart = LightweightCharts.createChart(document.getElementById('chart'), { width: 500, height: 300 });
        series = chart.addCandlestickSeries();
      }
      series.setData(data.history);
      document.getElementById('timer').innerText = '10';
      startCountdown();
    });

    function startCountdown() {
      let time = 10;
      const interval = setInterval(() => {
        time--;
        document.getElementById('timer').innerText = time;
        if (time <= 0) clearInterval(interval);
      }, 1000);
    }

    document.getElementById('up').onclick = () => predict('up');
    document.getElementById('down').onclick = () => predict('down');
    document.getElementById('pair').onchange = () => {
      currentPair = pairs[document.getElementById('pair').value];
      socket.emit('changePair', currentPair);
    };

    function predict(dir) {
      if (document.getElementById('timer').innerText != '0') return;
      socket.emit('predict', { pair: currentPair, dir, username });
    }

    socket.on('result', res => {
      document.getElementById('gems').innerText = res.gems;
      document.getElementById('attempts').innerText = res.attempts;
      alert(res.correct ? "DOĞRU! +1 Taş" : "YANLIŞ!");
    });

    socket.on('leaderboard', lb => {
      console.log('LB güncellendi', lb);
    });
  </script>
</body>
</html>
